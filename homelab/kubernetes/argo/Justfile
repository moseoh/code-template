# ArgoCD ê´€ë¦¬ ëª…ë ¹ì–´

# Helm ì €ì¥ì†Œ ì´ë¦„
NAMESPACE := "argocd"

# ë„ì›€ë§ í‘œì‹œ
_default:
    @just --list


# ArgoCD ì„¤ì¹˜
install:
    @echo "ğŸ“¦ ArgoCD ì„¤ì¹˜ ì¤‘..."
    helm repo add argo https://argoproj.github.io/argo-helm || true
    helm repo update
    helm upgrade --install argocd argo/argo-cd \
        --create-namespace \
        --namespace {{NAMESPACE}} \
        --values values.yml \
        --wait
    @echo "âœ… ArgoCD ì„¤ì¹˜ ì™„ë£Œ!"
    @echo ""
    @echo "ğŸ”‘ ì´ˆê¸° admin íŒ¨ìŠ¤ì›Œë“œ í™•ì¸:"
    @echo "kubectl -n {{NAMESPACE}} get secret argocd-initial-admin-secret -o jsonpath='{.data.password}' | base64 -d && echo"

# ArgoCD ì œê±°
uninstall:
    @echo "ğŸ—‘ï¸  ArgoCD ì œê±° ì¤‘..."
    helm uninstall argocd --namespace {{NAMESPACE}}
    @echo "âœ… ArgoCD ì œê±° ì™„ë£Œ"

# ArgoCD ì—…ê·¸ë ˆì´ë“œ
upgrade:
    @echo "â¬†ï¸  ArgoCD ì—…ê·¸ë ˆì´ë“œ ì¤‘..."
    helm repo update
    helm upgrade argocd argo/argo-cd \
        --namespace {{NAMESPACE}} \
        --values values.yml \
        --wait
    @echo "âœ… ArgoCD ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ"

# ArgoCD ìƒíƒœ í™•ì¸
status:
    @echo "ğŸ“Š ArgoCD ìƒíƒœ í™•ì¸..."
    @echo ""
    @echo "=== Helm Release ==="
    helm status argocd -n {{NAMESPACE}}
    @echo ""
    @echo "=== Pods ==="
    kubectl get pods -n {{NAMESPACE}}
    @echo ""
    @echo "=== Services ==="
    kubectl get svc -n {{NAMESPACE}}
    @echo ""
    @echo "=== Ingress ==="
    kubectl get ingress -n {{NAMESPACE}}

# ì´ˆê¸° admin íŒ¨ìŠ¤ì›Œë“œ í™•ì¸
get-password:
    @echo "ğŸ”‘ ArgoCD ì´ˆê¸° admin íŒ¨ìŠ¤ì›Œë“œ:"
    @kubectl -n {{NAMESPACE}} get secret argocd-initial-admin-secret -o jsonpath='{.data.password}' | base64 -d && echo

# ArgoCD UIì— í¬íŠ¸í¬ì›Œë”©
port-forward:
    @echo "ğŸŒ ArgoCD UI í¬íŠ¸í¬ì›Œë”© ì‹œì‘ (http://localhost:8080)"
    kubectl port-forward svc/argocd-server -n {{NAMESPACE}} 8080:80
