# Claude ì„¤ì • íŒŒì¼ ê´€ë¦¬
# devconfig/.claudeì™€ ~/.claude ê°„ ë™ê¸°í™”

claude_source_dir := justfile_directory() + '/.claude'
claude_target_dir := env_var('HOME') + '/.claude'

# ~/.claude íŒŒì¼ë“¤ì„ devconfig/.claudeë¡œ ê°€ì ¸ì˜¤ê¸° (pull)
[group('claude')]
claude-pull:
    #!/usr/bin/env bash
    set -euo pipefail

    echo "ðŸ“¥ ~/.claude íŒŒì¼ë“¤ì„ devconfig/.claudeë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤"
    echo "=================================================="

    SOURCE_DIR="{{ claude_target_dir }}"
    TARGET_DIR="{{ claude_source_dir }}"

    if [ ! -d "$SOURCE_DIR" ]; then
        echo "âŒ $SOURCE_DIR ë””ë ‰í† ë¦¬ê°€ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
        exit 1
    fi

    echo ""
    echo "ðŸ“ ëŒ€ìƒ ë””ë ‰í† ë¦¬: $TARGET_DIR"

    # ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±
    mkdir -p "$TARGET_DIR"

    # devconfig/.claudeì— ì¡´ìž¬í•˜ëŠ” íŒŒì¼ë§Œ ~/.claudeì—ì„œ ê°€ì ¸ì˜¤ê¸°
    echo ""
    echo "ðŸ“‹ íŒŒì¼ ë³µì‚¬ ì¤‘..."

    # devconfig/.claudeì— ìžˆëŠ” íŒŒì¼ ëª©ë¡ì„ ê¸°ì¤€ìœ¼ë¡œ ë³µì‚¬
    find "$TARGET_DIR" -type f | while read -r target_file; do
        # ìƒëŒ€ ê²½ë¡œ ê³„ì‚°
        rel_path="${target_file#$TARGET_DIR/}"
        source_file="$SOURCE_DIR/$rel_path"

        if [ -f "$source_file" ]; then
            # ë””ë ‰í† ë¦¬ ìƒì„±
            mkdir -p "$(dirname "$target_file")"
            # íŒŒì¼ ë³µì‚¬
            cp -v "$source_file" "$target_file"
        else
            echo "âš ï¸  $source_file íŒŒì¼ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ìŠ¤í‚µ)"
        fi
    done

    echo ""
    echo "=================================================="
    echo "âœ… ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!"
    echo ""
    echo "ë³µì‚¬ëœ ìœ„ì¹˜: $TARGET_DIR"

# devconfig/.claude íŒŒì¼ë“¤ì„ ~/.claudeë¡œ ë°°í¬ (push)
[group('claude')]
claude-push:
    #!/usr/bin/env bash
    set -euo pipefail

    echo "ðŸ“¤ devconfig/.claude íŒŒì¼ë“¤ì„ ~/.claudeë¡œ ë°°í¬í•©ë‹ˆë‹¤"
    echo "=================================================="

    SOURCE_DIR="{{ claude_source_dir }}"
    TARGET_DIR="{{ claude_target_dir }}"

    if [ ! -d "$SOURCE_DIR" ]; then
        echo "âŒ $SOURCE_DIR ë””ë ‰í† ë¦¬ê°€ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
        exit 1
    fi

    echo ""
    echo "ðŸ“ ì†ŒìŠ¤ ë””ë ‰í† ë¦¬: $SOURCE_DIR"
    echo "ðŸ“ ëŒ€ìƒ ë””ë ‰í† ë¦¬: $TARGET_DIR"

    # ëŒ€ìƒ ë””ë ‰í† ë¦¬ ìƒì„±
    mkdir -p "$TARGET_DIR"

    # devconfig/.claudeì— ìžˆëŠ” íŒŒì¼ë§Œ ~/.claudeë¡œ ë³µì‚¬ (ì¶”ê°€ íŒŒì¼ì€ ìœ ì§€)
    echo ""
    echo "ðŸ“‹ íŒŒì¼ ë³µì‚¬ ì¤‘..."

    # devconfig/.claudeì˜ ëª¨ë“  íŒŒì¼ì„ ~/.claudeë¡œ ë³µì‚¬
    find "$SOURCE_DIR" -type f | while read -r source_file; do
        # ìƒëŒ€ ê²½ë¡œ ê³„ì‚°
        rel_path="${source_file#$SOURCE_DIR/}"
        target_file="$TARGET_DIR/$rel_path"

        # ë””ë ‰í† ë¦¬ ìƒì„±
        mkdir -p "$(dirname "$target_file")"
        # íŒŒì¼ ë³µì‚¬
        cp -v "$source_file" "$target_file"
    done

    echo ""
    echo "=================================================="
    echo "âœ… ë°°í¬ ì™„ë£Œ!"
    echo ""
    echo "ë°°í¬ëœ ìœ„ì¹˜: $TARGET_DIR"

# devconfig/.claude íŒŒì¼ ëª©ë¡ í™•ì¸
[group('claude')]
claude-list:
    #!/usr/bin/env bash
    set -euo pipefail

    echo "ðŸ“‹ devconfig/.claude íŒŒì¼ ëª©ë¡"
    echo "=================================================="

    SOURCE_DIR="{{ claude_source_dir }}"

    if [ ! -d "$SOURCE_DIR" ]; then
        echo "âŒ $SOURCE_DIR ë””ë ‰í† ë¦¬ê°€ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
        exit 1
    fi

    echo ""
    tree "$SOURCE_DIR" 2>/dev/null || find "$SOURCE_DIR" -type f

    echo ""
    echo "=================================================="